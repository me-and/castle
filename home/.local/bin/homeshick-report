#!/usr/bin/env bash
set -eu

cd "${HOMESHICK_DIR:-$HOME/.homesick/repos}"

if [[ -t 1 ]]; then
	# Output to terminal, so use colour.
	GREEN='\033[0;32m'
	BLUE='\033[0;34m'
	RED='\033[0;31m'
	PURPLE='\033[0;35m'
	RESET='\033[0m'
	up_to_date="${GREEN}up-to-date${RESET}"
	unavailable="${RED}could not check${RESET}"
	ahead="${RED}ahead${RESET}"
	behind="${PURPLE}behind${RESET}"
	modified="${RED}modified${RESET}"
	unknown="${BLUE}unexpected status %s${RESET}"
else
	up_to_date='up-to-date'
	unavailable='could not check'
	ahead='ahead'
	behind='behind'
	modified='modified'
	unknown='unexpected status: %s'
fi

if [[ -x homeshick/bin/homeshick ]]; then
	for repo in *; do
		printf '%s: ' "$repo"
		status=0
		homeshick/bin/homeshick check -q "$repo" || status=$?
		case "$status" in
		0)
			printf "$up_to_date\\n"
			;;
		69)  # Unavailable
			printf "$unavailable\\n"
			;;
		85)  # Ahead
			printf "$ahead\\n"
			;;
		86)  # Behind
			printf "$behind\\n"
			;;
		88)  # Modified
			printf "$modified\\n"
			;;
		*)
			printf "$unknown\\n" "$status"
			;;
		esac
	done
else
	printf 'Could not find homesick executable in %s\n' "$(pwd)"
fi
